"use strict";var _slicedToArray=function(){function t(t,r){var e=[],i=!0,n=!1,s=void 0;try{for(var a,o=t[Symbol.iterator]();!(i=(a=o.next()).done)&&(e.push(a.value),!r||e.length!==r);i=!0);}catch(t){n=!0,s=t}finally{try{!i&&o.return&&o.return()}finally{if(n)throw s}}return e}return function(r,e){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return t(r,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),fs=require("fs-extra"),path=require("path"),output=require("wow-cmd").output,cmdPath=process.cwd(),marked=require("marked"),cheerio=require("cheerio"),Handle=function(t,r,e){var i=t.params;i=i?i.toLocaleLowerCase():"";var n=[];try{if(!i)throw"未指定设置mock参数";var s=require(path.join(cmdPath,i)).default,a=s.inputDir,o=s.outputDir;a=path.join(cmdPath,a),o=path.join(cmdPath,o),output.success("mock.cmd=>","指定生成mock数据入口目录【"+a+"】"),output.success("mock.cmd=>","指定生成mock数据出口目录【"+o+"】");var u=[],c=[];!function t(r){fs.readdirSync(r).forEach(function(e){var i=path.join(r,e),s=fs.statSync(i),o=path.extname(i),l=i.replace(a,"").replace(/\\/g,"/"),p=l.split("/"),f=p[p.length-1];if(s.isFile()&&[".md"].indexOf(o)>-1){p.shift();var m=p[0],d=fs.readFileSync(i).toString(),h=cheerio.load(marked(d)),y=p[1].replace(".md","");c.push({id:""+p.join("/"),title:h("h1").text()||"",group:y.substring(0,4)+"-"+y.substring(4,6),date:y.substring(0,4)+"-"+y.substring(4,6)+"-"+y.substring(6,8)+" "+y.substring(8,10)+":"+y.substring(10,12)+":"+y.substring(12),abstract:h("p").text().substring(0,100)||"",time:y,classify:m,path:l}),n.push({input:i,output:"articles"+l});var b=u.filter(function(t){return t.title===m}),g=_slicedToArray(b,1),j=g[0];j?j.number++:u.push({title:m,number:1})}else s.isDirectory()&&-1===[].indexOf(f)&&t(i)})}(a),c.sort(function(t,r){return r.time-t.time}),n.push({input:path.join(o,"articles.json"),output:"mocks/articles.json"},{input:path.join(o,"classify.json"),output:"mocks/classify.json"}),fs.ensureDirSync(o),fs.writeFileSync(path.join(o,"articles.json"),JSON.stringify(c,null,4)),fs.writeFileSync(path.join(o,"classify.json"),JSON.stringify(u,null,4))}catch(t){output.error("mock.cmd=>","发布app错误："+t)}finally{e(n)}};Handle.options={cmd:["-m","--mock"]},module.exports=Handle;
