

# Linux 基础

> Linux 是一款操作系统，免费、开源、安全、高效、稳定，处理高并发非常强悍，现在很多的企业级别的项目都部署到 linux/unix 服务器运行。


## 学习流程

- 第一阶段：linux 环境下的基本操作命令
    + 文件操作命令 (rm、mkdir、chmod、chown)；
    + 编辑工具使用（vi、vim）；
    + 用户管理（useradd、userdel、usermod）；
    ...
- 第二阶段：linux 的各种配置（环境变量配置、网络配置、服务配置）；
- 第三阶段：linux 下如何搭建对应语言的开发环境（大数据、javaEE、Python 等）；
- 第四阶段：能编写 shell 脚本，对 linux 服务器进行维护；
- 第五阶段：能进行安全设置，防止攻击，保障服务器正常运行，能对系统调优；
- 第六阶段：深入理解 linux 系统（对内核有研究），熟练掌握大型网站应用架构组成，并熟悉各个环节的部署和维护方法；


## Linux 的主要发行版本

以 linux 为内核的主要的发行版本
- Redhat 
- CentOSE
- Ubuntu
- Suse
- 红旗 Linux


## 虚拟机的网络连接三种形式

— 桥连接：虚拟机的系统可以和其他系统通信，但可能会造成 ip 冲突；
- NAT：网络地址转换方式，虚拟机的系统可以访问其他系统，但外网系统不能访问虚拟机系统，不会造成 ip 冲突；
- 主机模式：虚拟机系统是一个独立的主机，不能访问外网；


## Linux 目录结构

Linux 的文件系统是采用级层式的树状目录结构，在此结构中的最上层是根目录 `/`，然后
在此目录下再创建其他的目录。
**在 Linux 世界中，一切皆文件。**

```
/                           // 根目录
├── root                    // 
│   ├── Desktop             // 
│   ├── Malidir             // 
├── bin                     // 存放常用的命令 
├── boot
├── dev
├── etc
├── home
├── var
├── lib
├── usr                     // 
│   ├── bin                 // 
│   ├── lib                 // 
├── media                   // 
```

- **`/bin`**（`/usr/bin`、`/usr/local/bin`）：存放常用的命令；
- `/sbin`（`/usr/sbin/`、`/usr/local/sbin`）：s 就是 Super User 的意思，
这里存放的是系统管理员使用的系统管理程序；
- **`/home`**：存放普通用户的主目录，在 Linux 中每个用户都有一个自己的目录，一般该目录名
是以用户的账号命名的；
- **`/root`**：该目录为系统管理员，也称作超级权限者的用户主目录；
- `/lib`：系统开机所需要最基本的动态连接共享库，其作用类似于 Windows 里的 DLL 文件。
几乎所有的应用程序都需要用到这些共享库；
- `/lost+found`：这个目录一般情况下是空的，当系统非法关机后，这里就存放了一些文件；
- **`/etc`**：所有的系统管理所需要的配置文件和子目录；
- **`/usr`**：非常重要的目录，用户的很多应用程序和文件都放在这个目录下，类似于 Windows 下的 
program files 目录；
- **`/boot`**：存放的是启动 Linux 时使用的一些核心文件，包括一些连接文件以及镜像文件；
- `/proc`：是一个虚拟的目录，它是系统内存的映射，访问这个目录来获取系统信息；
- `/srv`：service 的所写，存放一些服务启动之后需要提取的数据；
- `/sys`：这是 linux2.6 内核的一个很大的变化。该目录下安装了 2.6 内核中新出现的一个文件
系统 sysfs；
- `/tmp`：这个目录是用来存放一些临时文件的；
- **`/dev`**：类似于 windows 的设备管理器，把所有的硬件用文件的形式存储；
- **`/media`**：linux 系统会自动识别一些设备，例如 U盘、光驱等等，当识别后，linux 会把识别
的设备挂载到这个目录下；
- **`/mnt`**：系统提供该目录是为了让用户临时挂载别的文件系统的，我们可以将外部存储挂载在
/mnt/上，然后进入该目录就可以查看里面的内容了；
- `/opt`：这是给主机额外安装软件所摆放的目录。如安装 ORACLE 数据库就可以放到该目录下，默认空；
- **`/usr/local`**：这是另一个给主机额外安装软件所安装的目录。一般是通过编译源码方式安装的程序；
- **`/var`**：这个目录中存放着在不断扩充的东西，习惯将经常被修改的目录放到这个目录下。包括各自日志文件；
- `/selinux`：SELinux 是一种安全子系统，它能控制程序只能访问特定文件；

总结一下
- linux 的目录中有且只有一个根目录 `/`；
- linux 的各个目录存放的内容是规划好，不能乱放文件；
- linux 是以文件的形式管理我们的设备，因此在 linux 系统中，一切皆文件；


## vi 和 vim 编辑器

所有的 Linux 系统都会内置 vi 文本编辑器。vim 具有程序编辑的能力，可以看做是 vi 的增强版本，可以主动的以字体颜色
辨别语法的正确性，方便程序设计。代码不全、编辑以及错误跳转等方便编程的功能特别丰富。


### vi 和 vim 常用的三种模式

- 正常模式：以 vim 打开一个档案就直接进入。在这个模式中，可以使用『上下左右』按键来移动光标，
可以使用『删除字符』或『删除整行』来处理档案内容，也可以使用『复制、粘贴』来处理文件数据。
- 插入模式：按下 `i`、`I`、`o`、`O`、`a`、`A`、`r`、`R`等任何一个字母之后才会进入编辑模式，
一般来说按 `i` 即可。按 `esc` 健可以退出插入模式；
- 命令行模式：在这个模式当中，可以提供你相关指令，完成读取、存盘、替换、离开、显示行号等；按 `:` 即可进入
命令模式；


### vi 和 vim 的快捷键

- 拷贝当前行 `yy`，拷贝当前行向下的5行 `5yy`，按 `p` 粘贴；
- 删除当前行 `dd`，删除当前行向下的5行 `5dd`； 
- 在文件中查找某个单词【命令行下 `/关键字`，回车查找，输入 n 就是查找下一个】
- 设置文件的行号，取消文件的行号【命令行下，`:set nu` 、`:set nonu` 】
- 快捷键到达文件的最末行【`G`】和最首行【`gg`】；
- 在一个文件中输入文字，然后又要撤销这个动作 `u`；
- 将光标移动到指定行
    1. `:set nu`】显示行号；
    2. 输入20这个数；
    3. 【`shift + g`】；
    


## 开机、重启、用户登录注销

### 关机 & 重启命令

- `shutdown -h now`：立即进行关机；
- `shutdown -h 1` ：1分钟后会关机；
- `shutdown -r now`：重启计算机；
- `halt`：关机，作用和上面一样；
- `reboot`：现在重新启动计算机；
- `sync`：把内存的数据同步到磁盘；

### 用户登录注销

- 登录时尽量少用 `root` 账号，因为它是系统管理员，最大的权限，避免操作失误。可以利用普通
用户登录，登录之后再利用 `su - 用户名` 来切换成系统管理员身份；
- 在提示符下输入 `logout` or `exit` 即可注销用户； 




## Linux 实用指令

### 指令运行级别

系统的运行级别配置文件 `/etc/inittab` 下

- 0 关机
- 1 单用户（找回丢失密码）
- 2 多用户无网络服务
- 3 多用户有网络服务
- 4 保留
- 5 图形界面
- 6 系统重启

常用的运行级别是 3 和 5，要修改默认的运行级别可改文件 `/etc/inittab` 的 `id:5:initdefault` 这一行中的数字。
命令【`init [012356]`】可以修改运行级别。

**如何找回 root 密码？**
进入到单用户模式，然后修改 root 密码，因为进入到单用户模式，root 不需要密码就能登录。
- 开机 => 在引导时输入【回车健】 => 进入到一个界面输入【e】 => 看到一个新的界面，选中
第二行（编辑内核）再输入【e】 => 在这行的最后输入【1】，再输入【回车健】 => 再次输入 b，
这时就会进入单用户模式登录 root 账号；
- 使用 `passwd root` 修改密码；


### 帮助指令

当我们对某个指令不熟悉时，可以使用 Linux 提供的帮助指令来了解这个指令。

- `man [命令或配置文件]` 获取帮助信息；
- `help [命令]` 功能描述，获取 `shell` 内置命令的帮助信息；


### 文件目录类指令

- `pwd` 显示当前工作目录的绝对路径；
- `ls`
    + `ls [选项] [目录或文件]`
    + 常用选项
        * `-a` 显示当前目录所有的文件和目录，包括隐藏；
        * `-l` 以列表的方式显示信息；
        * `-h` 以列表的方式显示信息，文件大小会整合成 M；
- `cd [目录]` 切换到指定目录；
    + `cd ~` 或者 `cd :` 回到自己的家目录；
- `mkdir` 用于创建目录；
    + `mkdir [选项] 目录名`；
    + 常用选项
        * `-p` 创建多级目录；
- `rmdir` 删除空目录
    + `rmdir [选项] 目录名`；
- `rm [选项] 目录名` 删除文件或目录；
    + `-r` 递归删除整个文件夹；
    + `-f` 强制删除不提示；
- `touch [文件名称]`：创建空文件；
- `cp [选项] soure dest` 拷贝指令；
    + `-r` 递归复制整个文件夹；
    + `\cp` 强制覆盖不提示；
- `mv source desc` 移动文件与目录或重命名；
- `cat [选项] 文件名` 查看文件内容；
    + `-n` 显示行号；
    + `cat -n 文件名 | more` 分页查看文件；
- `more` 是一个基于 VI 编辑器的文本过滤器，它以全屏幕的方式按页显示文本文件的内容；
    + `space` 代表向下翻页；
    + `enter` 代表向下翻一行；
    + `q` 代表立刻退出 `more`；
    + `Ctrl + F` 向下滚动一屏；
    + `Ctrl + B` 返回上一屏；
    + `=` 输出当前行的行号；
    + `:f` 输出文件名和当前的行号；
- `less` 用来分屏查看文件内容，它的功能与 `more` 指令类似，但是比 `more` 指令更加强大，支持
各种显示终端。`less` 指令在显示文件内容时，并不是一次将整个文件加载之后才显示，而是根据显示
需要加载内容，对于显示大型文件具有较高的效率；
    + `space` 向下翻页；
    + `pagedown` 向下翻页；
    + `pageup` 向上翻页；
    + `/字符串` 向下搜索【字符串】的功能；
        * `n` 向下查找；
        * `N` 向上查找；
    + `?字符串` 向上搜索【字符串】的功能；
        * `n` 向下查找；
        * `N` 向上查找；
    + `q` 代表立刻退出 `less`；
- `>` 输出重定向 / `>>` 追加；如果文件不存在，就会创建该文件；
    + `ls -l > 文件` 列表的内容写入到文件中（覆盖写）；
    + `ls -al >> 文件` 列表的内容追加到文件的末尾；
    + `cat 文件1 > 文件2` 将文件1的内容覆盖到文件2；
    + `echo 内容 >> 文件` 将文字【内容】追加的文件末尾；
- `echo [选项] [输出内容]` 输出内容到控制台；
    + `echo $PATH` 使用 `echo` 输出环境变量；
- `head` 用于显示文件的开头部分内容，默认情况下 `head` 指令显示文件的前10行内容；
    + `head -n 5 文件` 查看文件头5行内容；
- `tail` 用于输出文件中尾部的内容，默认情况下是显示文件的后10行内容；
    + `tail -n 5 文件` 查看文件后5行内容；
    + `tail -nf 5 文件` 实时追踪该文档的所有更新；
- `ln -s [原文件或目录] [软链接名]` 软链接也叫符号链接，类似于 windows 里面的快捷方式，主要存放了链接其他文件的路径；
当使用 `pwd` 查看目录时，看到的时软链接所在的目录；
    + `rm -rf 软连接名` 删除软链接名；
    + **注意：** 不要加/，不然会把源文件目录也会删除；
- `history` 查看已经执行过历史命令，也可以执行历史命令；
    + `history 10` 查看最近使用过的10个历史指令；
    + `!3` 执行历史指令3；
   
    
### 时间日期类的指令

- `date` 显示/设置当前日期
    + `date +%Y` 显示当前年份；
    + `date +%m` 显示当前月份；
    + `date +%d` 显示当前时哪一天；
    + `date "+%Y-%m-%d %H:%M:%S"` 显示年月日时分秒；
    + `date -s 字符串时间` 设置系统时间；
- `cal [选项]` 查看日历指令；
    + `cal 2020` 查看一年的日历；


### 搜索查找类的指令

- `find [搜索范围] [选项]` 指令将从指定目录向下递归地遍历其各个子目录，将满足条件的文件或者目录显示在终端；
    + `find -name <查询方式>` 按照指定的文件名查找模式查找文件，`find /home -name hello.txt`；
    + `find -user <用户名>` 查找属于指定用户名所有文件；
    + `find -size <文件大小>` 按照指定的文件大小查找（+n 大于、-n 小于、n 等于）；
    ```
    // 查找大于20M 的文件
    find / -size +20M
    ```
- `locate` 可以快速定位文件路径。利用事先建立的系统中所有文件名称及路径的 locate 数据库实现快速定位给定的文件。
`locate` 指令无需遍历整个文件系统，查询速度较快，为了保证查询结果的准确度，管理员必须定期更新 `locate` 时刻；
    + `updatedb` 由于 `locate` 指令基于数据库进行查询，所以第一次运行前，必须使用 `updatedb` 指令创建 `locate` 数据库；
- `grep [选项] 查找内容 源文件` 过滤查找，配合管道符 `|`；
    + `|` 管道符表示将前一个命令的处理结果输出传递给后面的命令处理；
    + `-n` 显示匹配行及行号；
    + `-i` 忽略字母大小写；
    ```
    cat hello.txt | grep -n yes
    ```


### 压缩和解压类

- `gzip` / `gunzip` 前者用于压缩文件，后者用于解压文件；
    + `gzip 文件` 压缩文件，只能将文件压缩为 `*.gz` 文件；
    + `gunzip 文件.gz` 解压文件；
    + **注意** 使用 `gzip` 压缩文件之后，源文件不保留；
- `zip` / `unzip` 前者用于压缩文件，后者用于解压文件；
    + `zip [选项] xxx.zip` 压缩文件或目录；
    + `unzip [选项] xxx.zip` 解压文件或目录；
    + `zip` 常用选项
        * `-r` 递归压缩，即压缩目录；
        * `zip -r test.zip /home/` 示例；
    + `unzip` 常用选项
        * `-d<目录>` 指定解压后文件的存放目录；
        * `unzip -d /opt/tmp/ test.zip` 示例；
- `tar [选项] xxx.tar.gz [文件]` 即可以打包，也可以解压，打包会生成 `.tar.gz` 文件；
    + `-c` 产生 .tar 打包文件；
    + `-v` 显示详细信息；
    + `-f` 指定压缩后的文件名；
    + `-z` 打包同时压缩；
    + `-x` 解压包 `.tar` 文件；
    + 应用案例
        * `tar -zcvf text.tar.gz a1.txt a2.txt` 压缩多个文件；
        * `tar -zxvf text.tar.gz` 解压文件；
        * `tar -zxvf text.tar.gz -C /opt/tem/` 解压到指定目录（目录要事先存在）；




## 组管理和权限管理

Linux 系统是一个多用户多任务的操作系统，任何一个要使用系统资源的用户，都必须首先向系统管理员
申请一个账号，然后以这个账号的身份进入系统。

Linux 系统的用户至少要属于一个组。


### Linux 组的基本介绍

在 linux 中的每个用户必须属于一个组，不能独立于组外。在 linux 中每个文件有所有者、所在组、其它组的概念；
- 所有者；
- 所在组；
- 其它组；
- 改变用户所在组；


### 用户基本语法

- `useradd [选项] 用户名`：添加用户；
    + 当用户创建成功后，会自动在 `/home/` 下创建和用户名同名的家目录；
    + 也可以通过 `useradd -d 目录 用户名` 指定目录新的用户名，给新创建的用户指定家目录；
- `passwd 用户名`：设置/修改密码；
- `userdel 用户名`：删除用户；
    + 删除用户保留家目录： `userdel 用户名`；
    + 删除用户且删除家目录： `userdel -r 用户名`；
- `id 用户名`：查看用户；
- `su - 用户名`：切换用户；
    + 当一个高权限用户切换到低权限用户时，不用输入密码；
    + `exit` 可以退出切换的用户回到原先的用户；
- `whoami` / `who am i`：查看当前用户/登录用户；


### 用户组

类似于角色，系统可以对有共性的多个用户进行统一的管理。

基本语法
- `groupadd 组名`：新增一个组；
- `groupdel 组名`：删除一个组；
- `useradd -g 用户组 用户名`：添加用户时直接加上组；
- `usermod -g 用户组 用户名`：修改用户的组；
- `useradd -d 目录 用户名`： 指定目录新的用户名，给新创建的用户指定家目录；
- `usermod -d 目录 用户名`： 修改用户家目录；

### 用户和组的相关文件

- `/etc/passwd` 文件
    + 用户（user） 的配置文件，记录用户的各种信息；
    + 每行的含义：用户名:口令:用户标识号:组标识号:注释性描述:主目录:登录Shell；
- `/etc/shadow` 文件
    + 口令的配置文件（密码和登录信息，是加密的）；
    + 每行的含义：登录名:加密口令:最后一次修改时间:最小时间间隔:最大时间间隔:警告时间:不活动时间:失效时间:标志；
- `/etc/group` 文件
    + 组（group）的配置文件，记录 Linux 包含的组的信息；
    + 每行的含义：组名:口令:组标识号:组内用户列表；


### 文件/目录所有者

- `ls -ahl` 查看文件的所有者、所在组；
- `chown 用户名 文件名` 修改文件所有者；
- `chown newowner:newgroup 文件名` 改变用户的所有者和所有组；
- `chown -R 用户名 目录` 如果是目录，`-R` 可以递归修改该目录下所有子文件或目录；
- `chgrp 组名 文件名` 修改文件所在组；
- `chgrp -R 组名 目录` 修改文件所在组，`-R` 可以递归修改该目录下所有子文件或目录；


### 权限的基本介绍

ls -l 中显示的内容如下：
```
-rwxrw-r-- 1 root root 1213 Feb 2 09:39 abc
```
说明
- 第0位确定文件类型（d、-、l、c、b）；
    + `-` 普通文件；
    + `d` 目录；
    + `l` 软链接；
    + `c` 字符设备（键盘、鼠标...）
    + `b` 块文件（硬盘）
- 第1-3位确定所有者（该文件的所有者）拥有该文件的权限。---User
- 第4-6位确定所属组（同用户组的）拥有该文件的权限。---Group
- 第7-9位确认其他用户拥有该文件的权限。---Other


### rwx 权限详解

- rwx 作用到文件
    + `r` 表示可读（read），可以读取查看；
    + `w` 表示可写（write），可以修改，但是不代表可以删除该文件，删除一个文件的前提条件是对该文件所在的目录有写权限，
    才能删除该文件；
    + `x` 表示可执行（execute），可以被执行；
- rwx 作用到目录
    + `r` 代表可读（read），可以读取，ls 查看目录内容；
    + `w` 代表可写（write），可以修改，目录内创建、删除、重命名目录；
    + `x` 代表可执行（execute），可以进入到该目录；
- 可用数字表示为：`r=4,w=2,x=1` 因此 `rwx=4+2+1=7`；


### 修改权限 chmod

通过 `chmod` 指令，可以修改文件或者目录的权限；

- 第一种方式 `+、-、=` 变更权限，`u`所有者、`g`所有组、`o`其他人、`a`所有人（u、g、o 的总和）；
    + `chmod u=rwx,g=rx,o=x 文件目录名`；
    + `chmod o+w 文件目录名`；
    + `chmod a-x 文件目录名`；
- 第二种方式，通过数字变更权限，`r=4,w=2,x=1` `rwx=4+2+1=7`；
    + `chmod u=rwx,g=rx,o=x 文件目录名` 相当于 `chmod 751 文件目录名`；




## 定时任务调度

- `crontab [选项]` 进行定时任务调度；
    + `-e` 编辑 crontab 定时任务；
    + `-l` 查询 crontab 定时任务；
    + `-r` 删除当前用户所有的 crontab 定时任务；
- `service crond restart [重启任务调度]`


### 快速入门

1. 设置任务调度文件 `/etc/crontab`；
2. 设置个人任务调度，执行 `crontab -e` 命令；
3. 接着输入任务到调度文件，如 `*/1 * * * * ls -l /ect/ > /tmp/to.txt`，意思说
每小时的每分钟执行 `ls -l /etc/ > /tmp/to.txt` 命令；


### 参数细节说明

- 第一个*：一个小时当中的第几分钟（0-59）；
- 第二个*：一天当中的第几个小时（0-23）；
- 第三个*：一个月当中的第几天（1-31）；
- 第四个*：一年当中的第几月（1-12）；
- 第五个*：一周当中的星期几（0-7）；


### 符号说明

- `*` 代表任何时间，比如第一个 `*` 就代表一个小时中每分钟都执行一次的意思；
- `,` 代表不连续时间，比如 `0 8,12,16 * * * 命令`，就表示在8点0分、12点0分、16点0分都执行一次命名；
- `-` 代表连续时间范围，比如 `0 5 * * 1-6 命令`，代表在周一到周六凌晨5点0分执行命令；
- `*/n` 代表每隔多久执行一次，比如 `*/10 * * * * 命令`，代表每隔 10 分钟执行一遍命令； 


### 案例说明

每隔1分钟，就将当前的日期，追加到 `/tmp/mydate` 文件中；
```
// 1. 先编写一个脚本文件
// /home/mytask1.sh
date >> /tmp/mydate

// 2. 给 mytask1.sh 一个可以执行的权限
chmod 744 /home/mytask1.sh

// 3. 输入 crontab -e
*/1 * * * * /home/mytask1.sh
```



## Linux 磁盘分区、挂载
    

### 基本介绍

- Linux 来说无论有几个分区，分给哪一个目录使用，它归根结底就只有一个根目录，一个独立且唯一的文件结构，
Linux 中的每个分区都是用来组成整个文件系统的一部分；
- Linux 采用了一种叫「载入」的处理方法，它的整个文件系统中包含了一整套的文件和目录，且将一个分区和一个目录
联系起来，这时要载入的一个分区将使它的存储空间在一个目录下获得；


### 分区的方式

- mbr 分区
    + 最多支持四个主分区；
    + 系统只能安装在主分区；
    + 扩展分区要占一个主分区；
    + MBR 最大只支持 2TB，但拥有最好的兼容性；
- gtp 分区
    + 支持无限多个主分区（但操作系统可能限制）；
    + 最大支持 18EB 的大容量（1EB=1024PB, 1PB=1024TB）； 

### Linux 分区

![步骤](images/WX20210413-111116.png)

`lsblk -f` 查看系统分区和挂载的情况

![步骤](images/WX20210413-112500.png)


### 如果增加一块硬盘

1. 虚拟机添加硬盘；
2. 分区 `fdisk /dev/sdb`；
3. 格式化 `mkfs -t ext4 /dev/sdb1`；
4. 挂载 `mount /dev/sdb1 /home/newdisk`；(临时挂载，重启系统后会失效)
5. 设置可以自动挂载（永久挂载，系统重启后，自动挂载上）；
    - 修改 `vim /etc/fstab` 配置；
    - `mount -a` 自动挂载启动配置；
    ![步骤](images/WX20210413-113920.png)
6. 卸载 `umount /dev/sdb1`



### 磁盘情况查询

- `df [选项]` 基本语法；
    + `-l` 列表形式；
    + `-h` 带计量单位；
- `du [选项] /目录` 查询指定目录的磁盘占用情况，默认为当前目录；
    + `-s` 指定目录占用大小汇总；
    + `-h` 带计量单位；
    + `-a` 包含隐藏文件；
    + `--max-depth=1` 子目录深度；
    + `-c` 列出明细的同时，增加汇总值；
    + `du -ach --max-depth=1 /opt`；


### 经常要使用的一些命令

- 统计 `/home` 下有多少个文件
```
ls -l /home | grep "^-" | wc -l
```
- 统计 `/home` 文件夹下文件的个数，包括子文件夹里的
```
ls -lR /home | grep "^-" | wc -l
```



## 网络配置

指定固定 ip，直接修改配置文件来指定 IP，并可以连接到外网，编辑 `vi /etc/sysconfig/network-scripts/ifcfg-eth0`
![步骤](images/WX20210413-124137.png)

`service network restart` 重启网络服务



## 进程管理


### 基本介绍
![基本介绍](images/WX20210413-124439.png)


### 查看进程

`ps [选项]` 是用来查看目前系统中，有那些正在执行，以及它们的执行情况；
- 显示的信息
    + `PID` 进程识别号；
    + `TTY` 终端机号；
    + `TIME` 此进程所消 CPU 时间；
    + `CMD` 正在执行的命令或进程；
    ![显示的信息](images/WX20210413-125130.png)
- 选项
    + `-a` 显示当前终端的所有进程信息；
    + `-u` 以用户的格式显示进程信息；
    + `-x` 显示后台进程运行的参数；
    + `-e` 显示所有进程；
    + `-f` 全格式；
- 使用 `ps -aux | grep sshd`；
- 使用 `ps -ef | more` 分页查看父进程；
- `pstree [选项]` 可以更加直观的来看进程信息；
    + `-p` 显示进程的 PID；
    + `-u` 显示进程的所属用户；
    
`top [选项]` top 与 ps 命令很相似。它们都是用来显示正在执行的进程。top的不同在于执行一段时间可以更新正在运行的进程。
- `-d 秒数` 指定 top 命令每隔多少秒更新，默认是 3 秒；
- `-i` 使 top 不显示任何闲置或者僵死的进程；
- `-p` 通过指定监控进程 ID 来监控某个进程的状态；
- 命令操作
    `u` 可以输入用户查看特定用户开启的进程；
    `k` 可以指定终止某个进程；
    `P` 以 cpu 使用率排序，默认就是这个；
    `M` 以内存的使用率排序；
    `N` 以 PID 排序；
    `q` 退出 top
    


### 终止进程

- `kill [选项] 进程号` 通过进程号来杀死进程；
    + `-9` 表示强迫进程立即停止， `ps -aux | grep bash` 查询终端进程；
- `killall 进程名称` 通过进程名称来杀死进程，也支持通配符，这在系统因为负载过大而变得很慢时很有用； 




## 服务管理

### 服务管理指令
- `service 服务名 start|stop|restart|reload|status` 这种方式都是临时生效的；
- `systemctl` CentOS7.0 之后使用这个指令；
- `service iptables status` 查看防火墙服务；
    + `/etc/sysconfig/iptables` 防火墙服务配置文件；
- **`telnet`** 通过这个指令检测 linux 某个端口是否在监听；
    + `telnet ip post`
- 查看系统服务
    + `setup` 命令
    + `/ect/init.d/`
    
### 服务的运行级别

![运行级别](images/WX20210413-135836.png)

`chkconfig` 命令可以给各个运行级别设置自启动/关闭；
- `chkconfig --list | grep xxx` 查看某个服务；
- `chkconfig 服务名 --list`；
- `chkconfig --level 5 服务名 on/off`；

**`chkconfig`** 需要重启系统才会有效。


### 监控网络服务

`netstat [选项]`
- `-an` 按一定顺序排列输出；
- `-p` 显示哪个进程在调用；



## RPM 与 YUM  与 APT

一种用于互联网下载包的打包及安装工具，它包含在某些 linux 分发版本中。它生成具有 `.RPM` 扩展名
的文件。RPM 是 RedHat Package Manager 的所写。


### rpm 包的管理

- 查询
    + `rpm -qa` 查询所安装的所有 rpm 软件包
    + `rpm -qa | grep xx` 查询已安装的 rpm 列表；
    + `rpm -q 软件包名` 查询软件包是否安装；
    + `rpm -qi 软件包名` 查询软件包信息；
    + `rpm -ql 软件包名` 查询软件包中的文件；
    + `rpm -qf 文件全路径名` 查询文件所属的软件包；
- 卸载
    + `rpm -e 软件包的名称`；
    + `rpm -e --nodeps 软件包` 强制删除；
- 安装
    + `rpm -ivh RPM包全路径名称`；
    + `-i` 安装；
    + `-v` 提示；
    + `-h` 进度条；
    
### yum 包的管理

Yum 是一个 Shell 前端软件包管理器，基于 RPM 包管理，能够从指定的服务器自动下载 RPM 包并且安装，
可以自动处理依赖性关系，并且一次安装所有依赖的软件包；

`yum list | grep xx` 查看服务器软件列表
`yum install xxx` 下载安装
`yum -y update`

- 安装
    + yum install              #全部安装
    + yum install package1     #安装指定的安装包package1
    + yum groupinsall group1   #安装程序组group1
- 更新和升级
    + yum update               #全部更新
    + yum update package1      #更新指定程序包package1
    + yum check-update         #检查可更新的程序
    + yum upgrade package1     #升级指定程序包package1
    + yum groupupdate group1   #升级程序组group1
- 查找和显示
    + yum info package1      #显示安装包信息package1
    + yum list               #显示所有已经安装和可以安装的程序包
    + yum list package1      #显示指定程序包安装情况package1
    + yum groupinfo group1   #显示程序组group1信息yum search string 根据关键字string查找安装包
- 删除程序
    + yum remove &#124; erase package1   #删除程序包package1
    + yum groupremove group1             #删除程序组group1
    + yum deplist package1               #查看程序package1依赖情况
- 清除缓存
    + yum clean packages       #清除缓存目录下的软件包
    + yum clean headers        #清除缓存目录下的 headers
    + yum clean oldheaders     #清除缓存目录下旧的 headers



### apt 软件管理

apt 是 Advanced Packaging Tool 的简称，是一款安装包管理工具。在 Ubuntu 下，我们可以使用 apt 命令可用于
软件包的安装、删除、清理等，类似于 Windows 中的软件管理工具；

apt 软件管理网络原理图
![软件管理网络原理图](images/WX20210414-164935.png)

apt 常用命令
![常用命令](images/WX20210414-165103.png)

更新 Ubuntu 软件下载地址，使用国内镜像源，文件配置目录 `/etc/apt/sources.list`
```
https://mirrors.tuna.tsinghua.edu.cn/
```
配置好了之后，需要更新源
```
sudo apt-get update
```

安装 sshd 服务
```
sudo apt-get install openssh-server

// 启动
service sshd restart
```


### 其他

`/etc/profile` 环境变量配置文件；
`source /etc/profile` 刷新环境变量；
![配置环境变量](images/WX20210413-154222.png)




## Shell 编程


### Shell 脚本的执行方式

1. 脚本以 `#!/bin/bash` 开头；
2. 脚本需要有可执行权限；


多行注释
```
:<<!
xxxx
xxxx
!
```


### Shell 变量的介绍

- 系统变量；
    + `$HOME`
    + `$PWD`
    + `$SHELL`
    + `$USER`
    + `$RANDOM` 获取随机数
- 用户自定义变量；
- `set` 显示当前 shell 中所有变量；


### Shell 变量的定义

- 定义变量：变量=值；
- 撤销变量： `unset 变量`；
- 声明静态变量： `readonly 变量`，注意不能 `unset`；
- 规则
    + 变量名称可以由字母、数字和下划线组成，不能以数字开头；
    + 等号两侧不能有空格；
    + 变量名称一般习惯大写；
- 将命令的返回值赋值给变量
```
// 反引号，运行里面的命令，并把结果返回给变量 A
A=`ls -la /home` 
// 等价与反引号
A=$(ls-la) 
```

### 设置环境变量

- `export 变量名=变量值` 将 `shell` 变量输出为环境变量；
- `source 配置文件` 让修改后的配置信息立即生效；
- `echo $变量名` 查询环境变量的值；


### 位置参数变量

当我们执行一个 shell 脚本的时候，如果希望获取到命令行的参数信息，就可以使用到位置参数变量，
比如 `./myshell.sh 100 200`，这个就是一个执行 shell 的命令行，可以在 myshell 脚本中获
取到参数信息。

- `$n` n 为数字，$0 代表命令本身，$1-$9代表第一到第九个参数，十以上的参数需要使用大括号形式：`${10}`；
- `$*` 这个变量代表命令行中所有的参数，所有的参数看成一个整体；
- `$@` 这个变量也代表命令行中所有的参数，不过 `$@` 把每个参数区分对待；
- `$#` 这个变量代表命令行中所有参数的数量； 


### 预定义变量

就是 shell 设计者事先已经定义好的变量，可以直接在 shell 脚本中使用。

- `$$` 当前进程的进程号（PID）；
- `$!` 后台运行的最后一个进程的进程号（PID）；
- `$?` 最后一次执行的命令的返回状态。如果这个变量的值为0，证明上一个命令正确执行，如果这个变量的值为非0（具体
是哪个数，由命令自己来决定），则证明上一个命令执行不正确了；


### 运算符

- `$((运算式))` 或 `$[运算式]`；
- `expr m + n` **注意** `expr` 运算符间要有空格；
- `expr m - n`；
- `\*`、`/`、`%` 乘，除，取余；

```
// 计算(2+3) * 4的值
RESULT = $(((2+3)*4))
echo $RESULT


// 计算(2+3) * 4的值 （推荐）
RESULT = $[(2+3)*4]
echo $RESULT

// 计算(2+3) * 4的值
TEMP=`expr 2 + 3`
RESULT=`expr $TEMP \* 4`
echo $RESULT
```


### 提交判断

- `[ condition ]` 注意 condition 前后要有空格；非空返回 true
```
[ xxx ] // 返回 true
[] // 返回 false
[ condition ]&&echo OK || echo notok // 提交满足执行后面的语句
```
- 两个整数的比较
    + `=` 字符串比较；
    + `-lt` 小于；
    + `-le` 小于等于；
    + `-eq` 等于；
    + `-gt` 大于；
    + `-ge` 大于等于；
    + `-ne` 不等于；
- 按照文件权限进行判断
    + `-r` 有读的权限；
    + `-w` 有写的权限；
    + `-x` 有执行的权限；
- 按照文件类型进行判断
    + `-f` 文件夹存在并且是一个常规文件；
    + `-e` 文件存在；
    + `-d` 文件存在并且是一个目录；

```
// 判断/root/install.log 文件是否存在
if [ -e /root/install.log ] 
then 
    echo "有"
fi
```


### 流程控制

- `if` 判断
```
if [ 条件 ]
then
    程序
elif [ 条件 ]
then
    程序
fi
```
- `case` 语句
```
case $变量名 in
    "值1"）
    程序1
    ;;
    "值2"）
    程序2
    ;;
    *）
    程序3
    ;;
esac
```
- `for` 循环
```
// 基本语法1
for 变量 in 值1 值2 值3...
do
    程序
done

// 基本语法2
for((初始值;循环控制条件;变量变化))
do
    程序
done
```
```
// 打印命令行输入的参数
for i in "$@"
do
    echo "the num is $i"
done

// 计算 1~100的和
SUM=0
for((i=1;i<=100;i++))
do
    SUM=$[$SUM+$i]
done
echo "sum=$SUM"
```
- `while` 循环
```
// 基本语法
while[ 条件 ]
do
    程序
done
```
- `read[选项](参数)` 读取控制台输入
    + `-p` 指定读取值时的提示符；
    + `-t` 指定读取值时等待的时间（秒），如果没有在指定的时间输入，就不再等待了
    + 参数指定读取值的变量名
```
// 读取控制台输入一个 num 值
read -p "请输入一个数num1=" NUM1
echo "你输入的值是num1=$NUM1"

// 读取控制台的一个 num 值 在10秒内输入
read -t 10 -p "请输入一个数num2=" NUM2
```


### 函数

shell 编程和其它编程语言一样，有系统函数，也可以自定义函数。

系统函数
- `basename` 返回完整路径最后/的部分，常用于获取文件名；
    * `basename [pathname] [suffix]`
```
// 输出 test.txt
basename /home/aaa/test.txt

// 输出 test
basename /home/aaa/test.txt .txt
```
- `dirname` 返回完整路径最后/的前面的部分，常用于返回路径部分；

自定义函数
```
// 基本语法
[ function ] funname[()]
{
    Action;
    [return int;]
}

// 调用直接写函数名 funname 
```
```
// 计算输入两个参数的和
function getSum() {
    # SUM=$[$n1+$n2]
    SUM=$[$1+$2]
    echo "和是=$SUM"
}

read -p "请输入第一个数n1" n1
read -p "请输入第二个数n2" n2

getSum $n1 $n2
```

### 综合案例

![综合案例](images/WX20210414-145112.png)

```
#!/bin/bash

#完成数据库的定时备份

#备份的路径
BACKUP=/data/backup/db
#当前的时间作为文件名
DATETIME=$(date +%Y_%m_%d_%H%M%S)

echo "==========开始备份========="
echo "========备份的路径是 $BACKUP/$DATETIME.tar.gz"

#主机
HOST=localhost
#用户名
DB_USER=root
#密码
DB_PWD=root
#备份数据库名
DATABASE=test

#创建备份的路径
#如果备份的路径文件夹存在，就使用，否则就创建
[ ! -d "$BACKUP/$DATETIME" ] && mkdir -p "$$BACKUP/$$DATETIME"

#执行 mysql 备份数据库的指令
mysqldump -u${DB_USER} -p${DB_PWD} --host=$HOST $DATABASE | gzip > $BACKUP/$DATETIME/$DATETIME.sql.gz

#打包备份文件
cd $BACKUP
tar -zcvf $DATETIME.tar.gz $DATABASE

#删除临时目录
rm -rf $BACKUP/$DATETIME

#删除10天前的备份文件
find $BACKUP -mtime +10 -name "*.tar.gz" -exec rm -rf {} \;
echo "==========备份成功========="
```
