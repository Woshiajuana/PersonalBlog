
# Android 开发数据库 Sqlite


## 创建数据库

1. 写一个类去继承 `SQLiteOpenHelper`;
2. 实现里面的方法;
3. 创建这个子类对象，再调用 `getWritableDatabase()` / `getReadableDatabase()`，即可创建数据库

```
// DatabaseHelper
class DatabaseHelper(
    context: Context?
) : SQLiteOpenHelper(
    context,  // 上下文
    Constants.DATABASE_NAME, // 数据库名称
    null, // 游标工厂
    Constants.VERSION_CODE // 版本号
) {
    override fun onCreate(db: SQLiteDatabase?) {
    
    }

    override fun onUpgrade(db: SQLiteDatabase?, oldVersion: Int, newVersion: Int) {
    }
}

// MainActivity
val helper = DatabaseHelper(this)
helper.writableDatabase

```

创建表

```
// 创建时候的回调，第一次创建数据库的时候被调用
override fun onCreate(db: SQLiteDatabase?) {
    println("创建数据库...")
    // 创建表
    // sql: create table table_name(_id integer, name varchar, age integer, salary integer);
    val sql = "create table ${Constants.TABLE_NAME}(_id integer, name varchar, age integer, salary integer)"
    db?.execSQL(sql)
}
```

## 编写 Dao 类

这个事用来操作数据库的增删改查

## 编写测试类


## 数据库升级

用户有可能会处于不同版本的数据库，所以在升级数据库中的回调，需要判断版本号，来执行相应的 sql 语句。

```
// 升级数据库的回调
override fun onUpgrade(db: SQLiteDatabase?, oldVersion: Int, newVersion: Int) {
    println("升级数据库...")
    // sql: alter table table_name add phone integer
    when (oldVersion) {
        1 -> {
            val sql = "alter table ${Constants.TABLE_NAME} add phone integer"
            db?.execSQL(sql)
        }
        2 -> {
            val sql = "alter table ${Constants.TABLE_NAME} add address varchar"
            db?.execSQL(sql)
        }
        3 -> {

        }
    }
}
```


## 数据库的增删改查


## 使用 Android 的 API 操作增删改查


## 数据库事务
